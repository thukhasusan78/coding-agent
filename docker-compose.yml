services:
  # 1. Traefik (Fixed Version)
  traefik:
    image: traefik:v3.6  # <--- v3.3 á€™á€›á€•á€«, v3.6 á€žá€­á€¯á€·á€™á€Ÿá€¯á€á€º latest á€‘á€¬á€¸á€™á€¾á€›á€™á€šá€º
    container_name: ironman-traefik
    restart: unless-stopped
    command:
      - "--configFile=/etc/traefik/traefik.yaml"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
      - ./config/traefik.yaml:/etc/traefik/traefik.yaml
    networks:
      - ironman_net
    ports:
      - "8080:8080"
      - "80:80"

  # 2. Cloudflare Tunnel (File Based Config)
  tunnel:
    image: cloudflare/cloudflared:latest
    container_name: ironman-tunnel
    restart: always
    command: tunnel run  # <--- config.yml á€›á€¾á€­á€›á€„á€º á€’á€®á€á€­á€¯á€„á€ºá€¸ run á€œá€­á€¯á€·á€›á€•á€¼á€®
    volumes:
      - ./workspace:/etc/cloudflared  # JSON key á€”á€²á€· config.yml á€’á€®á€‘á€²á€™á€¾á€¬á€›á€¾á€­á€›á€™á€šá€º
    networks:
      - ironman_net
    depends_on:
      - traefik

  # 3. The Brain (Jarvis Agent)
  # á€™á€„á€ºá€¸á€›á€²á€· á€¡á€“á€­á€€ Python Code á€á€½á€± run á€™á€šá€·á€ºá€€á€±á€¬á€„á€º
  jarvis:
    container_name: jarvis-brain
    build: .
    restart: always
    env_file:
      - .env
    volumes:
      - .:/app
      # ðŸ”¥ Host Docker á€€á€­á€¯ á€œá€¾á€™á€ºá€¸á€á€­á€¯á€„á€ºá€¸á€”á€­á€¯á€„á€ºá€™á€šá€·á€º "á€™á€¾á€±á€¬á€ºá€á€¶á€á€¬á€¸"
      - /var/run/docker.sock:/var/run/docker.sock
    networks:
      - ironman_net
    ports:
      - "8000:8000" # API Port
    tty: true

# Network á€á€…á€ºá€á€¯á€á€Šá€ºá€¸á€™á€¾á€¬ á€¡á€€á€¯á€”á€ºá€…á€¯á€…á€Šá€ºá€¸á€‘á€¬á€¸á€™á€šá€º
networks:
  ironman_net:
    external: false